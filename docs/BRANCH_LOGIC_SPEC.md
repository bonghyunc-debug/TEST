# Smart Capital Gain Wizard - 분기 로직 설계 명세서

## 개요

양도소득세 계산 위저드의 분기 로직 체계를 정의합니다.
분기 로직은 사용자 입력에 따라 필요한 필드만 표시하고, 적절한 계산 방법을 적용합니다.

---

## 1. 신고유형별 분기

### 1.1 분기 조건

| 신고유형 | 설명 |
|---------|------|
| 예정신고 | 양도일로부터 2개월 이내 신고 |
| 기한후신고 | 신고기한 경과 후 신고 |
| 수정신고 | 이미 신고한 내용 수정 |

### 1.2 UI 분기

| 신고유형 | 필수 입력 필드 | 선택 입력 필드 |
|---------|--------------|--------------|
| 예정신고 | 양도일, 신고일, 납부예정일 | - |
| 기한후신고 | 양도일, 신고일, 납부예정일 | - |
| 수정신고 | 양도일, 신고일, 납부예정일, 기납부세액(양도세/농특세) | - |

### 1.3 가산세 분기

| 신고유형 | 무신고 가산세 | 과소신고 가산세 | 납부지연 가산세 |
|---------|-------------|---------------|---------------|
| 예정신고 | ❌ | ❌ | ❌ |
| 기한후신고 | ✅ | ❌ | ✅ |
| 수정신고 | ❌ | ✅ | ✅ |

### 1.4 가산세 감면율 분기

#### 무신고 가산세 감면 (기한후신고)

| 신고 시점 | 감면율 |
|----------|-------|
| 법정기한 후 1개월 이내 | 50% 감면 |
| 법정기한 후 1~3개월 | 30% 감면 |
| 법정기한 후 3~6개월 | 20% 감면 |
| 법정기한 후 6개월 초과 | 감면 없음 |

#### 과소신고 가산세 감면 (수정신고)

| 신고 시점 | 감면율 |
|----------|-------|
| 법정기한 후 1개월 이내 | 90% 감면 |
| 법정기한 후 1~3개월 | 75% 감면 |
| 법정기한 후 3~6개월 | 50% 감면 |
| 법정기한 후 6개월~1년 | 30% 감면 |
| 법정기한 후 1~1.5년 | 20% 감면 |
| 법정기한 후 1.5~2년 | 10% 감면 |
| 법정기한 후 2년 초과 | 감면 없음 |

#### 납부지연 가산세

```
납부지연 가산세 = 미납세액 × 지연일수 × 0.022%
(연 8.03% 상당)
```

---

## 2. 자산유형별 분기

### 2.1 분기 조건

| 자산유형 | 코드 | 설명 |
|---------|-----|------|
| 일반주택 | general_house | 1세대1주택 외 주택 |
| 1세대1주택(고가) | high_price_house | 12억 초과 고가주택 |
| 상가/건물 | commercial | 상업용 건물 |
| 토지 | land | 일반 토지 (비사업용 선택 가능) |
| 농지 | land_farm | 농지 (자경 감면 선택 가능) |
| 분양권 | presale_right | 주택 분양권 |
| 조합원입주권 | membership_right | 재건축/재개발 입주권 |
| 미등기 | unregistered | 미등기 자산 |

### 2.2 UI 분기

| 자산유형 | 추가 입력 필드 | 비고 |
|---------|--------------|-----|
| 일반주택 | - | - |
| 고가주택 | 거주기간 | 장특공 거주기간 공제 적용 |
| 상가/건물 | - | - |
| 토지 | 면적, 사업용/비사업용 선택 | 사용자가 직접 판단하여 선택 |
| 농지 | 면적, 사업용/비사업용 선택 | 자경요건은 사용자가 판단 |
| 분양권 | - | - |
| 입주권 | - | - |
| 미등기 | - | - |

**※ 비과세 요건, 사업용/비사업용 판단, 자경요건 판단은 사용자가 결정합니다.**
**위저드는 결정된 내용에 따른 세액계산만 지원합니다.**

### 2.3 세율 분기

| 자산유형 | 기본세율 | 단기 중과 | 비사업용 중과 | 미등기 |
|---------|--------|----------|-------------|-------|
| 일반주택 | 누진세율 | 1년 미만 70%, 2년 미만 60% | - | - |
| 고가주택 | 누진세율 | 1년 미만 70%, 2년 미만 60% | - | - |
| 상가/건물 | 누진세율 | 1년 미만 50%, 2년 미만 40% | - | - |
| 토지(사업용) | 누진세율 | 1년 미만 50%, 2년 미만 40% | - | - |
| 토지(비사업용) | 누진세율+10% | 1년 미만 50%, 2년 미만 40% | ✅ | - |
| 농지 | 누진세율 | 1년 미만 50%, 2년 미만 40% | 선택에 따름 | - |
| 분양권 | 누진세율 | 1년 미만 70%, 2년 미만 60% | - | - |
| 입주권 | 누진세율 | 1년 미만 70%, 2년 미만 60% | - | - |
| 미등기 | 70% 단일 | - | - | ✅ |

### 2.4 장기보유특별공제 분기

| 자산유형 | 공제 유형 | 최대 공제율 |
|---------|---------|-----------|
| 일반주택 | 일반 (연 2%) | 30% |
| 고가주택 | 1세대1주택 (보유 4% + 거주 4%) | 80% |
| 상가/건물 | 일반 (연 2%) | 30% |
| 토지 | 일반 (연 2%) | 30% |
| 농지 | 일반 (연 2%) | 30% |
| 분양권 | 배제 | 0% |
| 입주권 | 배제 | 0% |
| 미등기 | 배제 | 0% |

---

## 3. 취득원인별 분기

### 3.1 분기 조건

| 취득원인 | 코드 | 설명 |
|---------|-----|------|
| 매매 | purchase | 일반 매매 취득 |
| 신축 | construction | 직접 건축 |
| 경매/공매 | auction | 경매 또는 공매로 취득 |
| 상속 | inheritance | 피상속인으로부터 상속 |
| 증여 | gift | 증여로 취득 (이월과세 미적용) |
| 증여(이월과세) | gift_carryover | 증여로 취득 (이월과세 적용) |

### 3.2 이월과세 재귀 분기

**이월과세 선택 시 당초 취득원인을 추가로 선택합니다.**

```
이월과세 선택
    └─→ 당초 취득원인 선택
            ├─ 매매 ───→ 매매 취득원인 분기 적용
            ├─ 상속 ───→ 상속 취득원인 분기 적용
            └─ 증여 ───→ 증여 취득원인 분기 적용
```

### 3.3 UI 분기

| 취득원인 | 추가 입력 필드 |
|---------|--------------|
| 매매 | - |
| 신축 | - |
| 경매/공매 | - |
| 상속 | 피상속인 취득일 |
| 증여 | - |
| 이월과세 | 당초 증여자 취득일, **당초 취득원인**, **기납부 증여세** |

### 3.4 취득가액 계산방법 분기

| 취득원인 | 사용 가능한 계산방법 | 비고 |
|---------|-------------------|-----|
| 매매 | 실지취득가액, 환산취득가액 | - |
| 신축 | 실지취득가액, 환산취득가액 | - |
| 경매/공매 | 실지취득가액, 환산취득가액 | - |
| 상속 | 실지취득가액, 기준시가 | 실거래가 없음 |
| 증여 | 실지취득가액, 기준시가 | 실거래가 없음 |
| 이월과세(최초 매매) | 실지취득가액, 환산취득가액 | 당초 취득원인 따름 |
| 이월과세(최초 상속) | 실지취득가액, 기준시가 | 당초 취득원인 따름 |
| 이월과세(최초 증여) | 실지취득가액, 기준시가 | 당초 취득원인 따름 |

### 3.5 세율/장특공 기산일 분기

| 취득원인 | 세율 기산일 | 장특공 기산일 |
|---------|-----------|-------------|
| 매매/신축/경매 | 취득일 | 취득일 |
| 상속 | 피상속인 취득일 | 피상속인 취득일 |
| 증여 | 취득일(증여일) | 취득일(증여일) |
| 이월과세 | 당초 증여자 취득일 | 당초 증여자 취득일 |

---

## 4. 취득일자별 분기

### 4.1 분기 조건

| 취득일자 구간 | 적용 로직 |
|-------------|----------|
| 1985.1.1 이전 | 의제취득일 1985.1.1 적용 |
| 1985.1.1 ~ 1990.8.30 | 토지등급 환산 적용 (토지만) |
| 1990.8.30 이후 | 현행 방식 |

### 4.2 의제취득일 분기

```
실제 취득일이 1985.1.1 이전인 경우:
    → 세율 계산용 보유기간 기산일 = 1985.1.1
    → 장특공 계산용 보유기간 기산일 = 1985.1.1
```

### 4.3 토지등급 환산 분기 (1990.8.30 이전 토지)

| 자산유형 | 취득원인 | 취득일자 | 환산 방식 |
|---------|---------|---------|----------|
| 토지/농지 | 매매/신축/경매 | 1990.8.30 이전 | 토지등급 환산 → **환산취득가액** |
| 토지/농지 | 상속 | 1990.8.30 이전 | 토지등급 환산 → **기준시가** |
| 토지/농지 | 증여 | 1990.8.30 이전 | 토지등급 환산 → **기준시가** |
| 토지/농지 | 이월과세(최초 매매) | 1990.8.30 이전 | 토지등급 환산 → **환산취득가액** |
| 토지/농지 | 이월과세(최초 상속/증여) | 1990.8.30 이전 | 토지등급 환산 → **기준시가** |

### 4.4 토지등급 환산 추가 입력 필드

1990.8.30 이전 취득 토지인 경우:

| 필드명 | 설명 |
|-------|------|
| 면적 (㎡) | 토지 면적 |
| 1990.1.1 개별공시지가 | 단위면적당 공시지가 |
| 취득 시 토지등급 | 1~365등급 |
| 1990.8.30 토지등급 | 1~365등급 |
| 1990.8.30 직전 토지등급 | 1~365등급 |

---

## 5. 분기 조합 매트릭스

### 5.1 복합 분기 우선순위

```
1. 신고유형 분기 (가산세 결정)
2. 자산유형 분기 (세율 유형, 장특공 유형 결정)
3. 취득원인 분기 (취득가액 계산방법 결정)
4. 취득일자 분기 (의제취득일, 토지등급 환산 결정)
```

### 5.2 조합 예시

| # | 자산 | 취득원인 | 취득일 | 신고유형 | 적용 결과 |
|---|------|---------|-------|---------|----------|
| 1 | 토지 | 매매 | 1988년 | 예정 | 토지등급 환산, 환산취득가액, 누진세율 |
| 2 | 토지 | 상속 | 1988년 | 예정 | 토지등급 환산, 기준시가, 누진세율 |
| 3 | 토지(비사업용) | 매매 | 2020년 | 기한후 | 환산취득가액, 누진+10%, 무신고가산세 |
| 4 | 분양권 | 매매 | 2023년 | 예정 | 실지취득가액, 단기중과(70%/60%), 장특공 배제 |
| 5 | 고가주택 | 이월과세(최초상속) | 2015년 | 수정 | 기준시가, 12억초과과세, 과소신고가산세 |
| 6 | 농지 | 상속 | 1989년 | 예정 | 토지등급 환산, 기준시가, 8년자경감면가능 |

---

## 6. 구현 인터페이스

### 6.1 분기 조건 타입

```typescript
interface BranchConditions {
  // 신고유형
  declarationType: 'regular' | 'after_deadline' | 'amended';
  transferDate: string;      // 양도일
  reportDate: string;        // 신고일
  paymentDate: string;       // 납부예정일
  
  // 자산유형
  assetType: AssetType;
  isNonBusinessLand?: boolean;  // 비사업용 토지 여부 (사용자 선택)
  
  // 취득원인
  acquisitionCause: AcquisitionCause;
  origAcquisitionCause?: 'purchase' | 'inheritance' | 'gift';  // 이월과세용
  
  // 취득일자
  acquisitionDate: string;
  origAcquisitionDate?: string;  // 상속/이월과세용
}
```

### 6.2 분기 결과 타입

```typescript
interface BranchResult {
  // UI 필드
  requiredFields: string[];
  optionalFields: string[];
  hiddenFields: string[];
  
  // 취득가액 계산
  acquisitionPriceMethods: ('actual' | 'converted' | 'official')[];
  usePre1990LandGrade: boolean;
  effectiveAcqDate: string;  // 의제취득일 적용 후
  
  // 세율
  taxRateType: 'progressive' | 'progressive_plus_10' | 'short_term' | 'unregistered';
  shortTermRate?: number;  // 단기 중과세율 (70% or 60% or 50% or 40%)
  
  // 장특공
  longTermDeductionType: 'general' | 'one_house' | 'none';
  
  // 가산세
  applyNonFilingPenalty: boolean;       // 무신고 가산세
  applyUnderReportPenalty: boolean;     // 과소신고 가산세
  applyLatePaymentPenalty: boolean;     // 납부지연 가산세
  penaltyReductionRate?: number;        // 가산세 감면율
  
  // 이월과세
  requireGiftTaxPaid: boolean;          // 기납부 증여세 입력 필요
}
```

---

## 7. 변경 이력

| 버전 | 일자 | 변경 내용 |
|-----|------|----------|
| 1.0 | 2024-12-15 | 최초 작성 |
| 1.1 | 2024-12-15 | 사용자 피드백 반영: 기한후신고 간소화, 자경기간 입력 제거, 이월과세 기납부증여세 추가 |
| 1.2 | 2024-12-15 | 수정신고 과소신고 가산세 감면율 추가 (1개월 90% ~ 2년 10%) |
